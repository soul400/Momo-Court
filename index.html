<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุญููุฉ ูููู โ๏ธ</title>
    <!-- ุฎุท ุงููุงูุฑุฉ -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ููุชุจุฉ ุงูุฃููููุงุช -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        cairo: ['Cairo', 'sans-serif'],
                    },
                    colors: {
                        momo: {
                            bg: '#1A202C',      // ูุญูู ุบุงูู
                            text: '#F7FAFC',    // ุฃุจูุถ ูุงุฆู ููุฑูุงุฏู
                            judge: '#D69E2E',   // ุฐูุจู
                            pros: '#E53E3E',    // ุฃุญูุฑ ูุงุชุญ
                            def: '#3182CE',     // ุฃุฒุฑู ุณูุงูู
                            jury: '#805AD5',    // ุจููุณุฌู
                            public: '#38B2AC',  // ุชุฑููุงุฒ ููุฌูููุฑ
                        }
                    },
                    animation: {
                        'gavel': 'pound 0.4s ease-in-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        pound: {
                            '0%, 100%': { transform: 'rotate(0deg)' },
                            '50%': { transform: 'rotate(-45deg)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #1A202C; color: #F7FAFC; }
        .glass-panel {
            background: rgba(45, 55, 72, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .scroll-custom::-webkit-scrollbar { width: 8px; }
        .scroll-custom::-webkit-scrollbar-track { background: #2D3748; }
        .scroll-custom::-webkit-scrollbar-thumb { background: #4A5568; border-radius: 4px; }
        .scroll-custom::-webkit-scrollbar-thumb:hover { background: #718096; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center bg-[#1A202C] overflow-x-hidden selection:bg-yellow-500 selection:text-black">

    <!-- ูุคุดุฑ ุญุงูุฉ ุงูุงุชุตุงู -->
    <div id="connection-status" class="fixed top-0 left-0 w-full text-center text-xs py-1 bg-yellow-600 text-black font-bold z-50 hidden">
        ุฌุงุฑู ุงูุงุชุตุงู ุจุงูุณูุฑูุฑ...
    </div>

    <!-- ูุงูุฐุฉ ุงูุฃุฎุทุงุก (ูููุณุงุนุฏุฉ ูู ุงูุชุดุฎูุต) -->
    <div id="error-toast" class="fixed bottom-4 left-4 max-w-sm bg-red-600 text-white p-4 rounded-lg shadow-2xl hidden z-50 text-sm">
        <strong class="block mb-1">ุฎุทุฃ ูู ุงููุธุงู:</strong>
        <span id="error-msg"></span>
        <button onclick="this.parentElement.style.display='none'" class="absolute top-2 left-2 text-white/50 hover:text-white">โ</button>
    </div>

    <!-- ุดุงุดุฉ ุงูุฏุฎูู -->
    <div id="login-screen" class="w-full max-w-md p-6 relative z-10 animate-fade-in">
        <div class="glass-panel p-8 rounded-2xl shadow-2xl text-center border-t-4 border-momo-judge">
            <div class="flex justify-center mb-4">
                <i data-lucide="scale" class="w-16 h-16 text-momo-judge"></i>
            </div>
            <h1 class="text-4xl font-black mb-2 text-momo-judge">ูุญููุฉ ูููู</h1>
            <p class="text-gray-400 mb-8 text-sm tracking-wide">ุงูุนุฏุงูุฉ ุงูุชูุงุนููุฉ | ุจุซ ูุจุงุดุฑ</p>
            
            <div class="relative">
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                    <i data-lucide="key" class="w-5 h-5 text-gray-500"></i>
                </div>
                <input type="password" id="access-code" 
                    class="w-full p-4 pr-10 bg-gray-800 text-white border border-gray-600 rounded-xl focus:outline-none focus:border-momo-judge focus:ring-2 focus:ring-momo-judge/50 transition-all placeholder-gray-500"
                    placeholder="ุฃุฏุฎู ุฑูุฒ ุงูุฏุฎูู...">
            </div>
            
            <button onclick="checkCode()" class="mt-6 w-full bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-gray-900 font-bold py-4 rounded-xl shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2">
                <span>ุฏุฎูู ุงููุงุนุฉ</span>
                <i data-lucide="door-open" class="w-5 h-5"></i>
            </button>
            
            <div class="mt-6 text-xs text-gray-500 space-y-1">
                <p>ุฑููุฒ ุชุฌุฑูุจูุฉ: ADMIN99, JUDGE1, PROS1, DEFENSE1, JURY1, GUEST</p>
            </div>
        </div>
    </div>

    <!-- ููุญุฉ ุงูุชุญูู (ุงูุฃุฏูู) -->
    <div id="admin-view" class="hidden w-full max-w-6xl p-4">
        <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
            <h2 class="text-3xl font-bold text-red-500 flex items-center gap-2">
                <i data-lucide="settings" class="w-8 h-8"></i>
                ุบุฑูุฉ ุงูุชุญูู
            </h2>
            <button onclick="location.reload()" class="bg-gray-700 px-4 py-2 rounded hover:bg-gray-600 text-sm">ุฎุฑูุฌ</button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- ุชูุงุตูู ุงููุถูุฉ -->
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                <h3 class="text-lg font-bold mb-4 text-gray-300">๐ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ</h3>
                <div class="space-y-4">
                    <input id="inp-case-title" placeholder="ุนููุงู ุงููุถูุฉ" class="w-full p-3 bg-gray-900 rounded border border-gray-700 focus:border-red-500 outline-none">
                    <textarea id="inp-case-desc" placeholder="ุญูุซูุงุช ุงููุถูุฉ (ุงููุตุฉ ุงููุงููุฉ)" class="w-full p-3 bg-gray-900 rounded h-32 border border-gray-700 focus:border-red-500 outline-none resize-none"></textarea>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <input id="inp-victim" placeholder="ุงุณู ุงููุฌูู ุนููู" class="p-3 bg-gray-900 rounded border border-gray-700 focus:border-red-500 outline-none">
                        <input id="inp-accused" placeholder="ุงุณู ุงููุชูู" class="p-3 bg-gray-900 rounded border border-gray-700 focus:border-red-500 outline-none">
                    </div>
                </div>
            </div>

            <!-- ุฃุทุฑุงู ุงููุถูุฉ -->
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                <h3 class="text-lg font-bold mb-4 text-gray-300">๐ฅ ุฃุทุฑุงู ุงููุฒุงุน</h3>
                <div class="space-y-4">
                    <div class="flex items-center gap-2">
                        <span class="w-8 h-8 rounded bg-momo-judge flex items-center justify-center text-black font-bold">Q</span>
                        <input id="inp-judge" placeholder="ุงุณู ุงููุงุถู" class="flex-1 p-3 bg-gray-900 rounded border border-gray-700 focus:border-momo-judge outline-none">
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-8 h-8 rounded bg-momo-pros flex items-center justify-center text-white font-bold">P</span>
                        <input id="inp-pros-lawyer" placeholder="ูุญุงูู ุงูุงุฏุนุงุก" class="flex-1 p-3 bg-gray-900 rounded border border-gray-700 focus:border-momo-pros outline-none">
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-8 h-8 rounded bg-momo-def flex items-center justify-center text-white font-bold">D</span>
                        <input id="inp-def-lawyer" placeholder="ูุญุงูู ุงููุชูู" class="flex-1 p-3 bg-gray-900 rounded border border-gray-700 focus:border-momo-def outline-none">
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-8 h-8 rounded bg-momo-jury flex items-center justify-center text-white font-bold">J</span>
                        <textarea id="inp-jurors" placeholder="ุฃุณูุงุก ุงููุญูููู (ูู ุงุณู ูู ุณุทุฑ ุฃู ููุตููุฉ ุจูุงุตูุฉ)" class="flex-1 p-3 bg-gray-900 rounded border border-gray-700 focus:border-momo-jury outline-none h-20 resize-none"></textarea>
                    </div>
                </div>
            </div>

            <!-- ุฅุฏุงุฑุฉ ุงูุดููุฏ -->
            <div class="lg:col-span-2 bg-gray-800 p-6 rounded-xl border border-gray-700">
                <h3 class="text-lg font-bold mb-4 text-gray-300 flex items-center gap-2">
                    <i data-lucide="eye" class="text-cyan-400"></i> ุฅุฏุงุฑุฉ ุงูุดููุฏ ูุงูุณููุงุฑูููุงุช
                </h3>
                <div id="witness-admin-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- ุณูุชู ุชูููุฏ ุญููู ุงูุฅุฏุฎุงู ููุง ุจูุงุณุทุฉ JS -->
                </div>
            </div>

            <!-- ุงูุฃุฏูุฉ -->
            <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-red-900/10 p-4 rounded-xl border border-red-900/50">
                    <h3 class="text-red-400 font-bold mb-2">๐ฅ ุฃุฏูุฉ ุงูุฅุฏุงูุฉ</h3>
                    <textarea id="inp-ev-guilt" placeholder="ุงูุชุจ ุงูุฃุฏูุฉ ููุง..." class="w-full p-3 bg-gray-900 rounded h-32 border border-red-900/50 focus:border-red-500 outline-none resize-none"></textarea>
                </div>
                <div class="bg-blue-900/10 p-4 rounded-xl border border-blue-900/50">
                    <h3 class="text-blue-400 font-bold mb-2">๐ก๏ธ ุฃุฏูุฉ ุงูุจุฑุงุกุฉ</h3>
                    <textarea id="inp-ev-innocence" placeholder="ุงูุชุจ ุงูุฃุฏูุฉ ููุง..." class="w-full p-3 bg-gray-900 rounded h-32 border border-blue-900/50 focus:border-blue-500 outline-none resize-none"></textarea>
                </div>
            </div>
        </div>

        <div class="mt-8 flex gap-4">
            <button id="save-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold shadow-lg transition flex items-center justify-center gap-2">
                <i data-lucide="save"></i> ุญูุธ ููุดุฑ ุงููุถูุฉ
            </button>
            <button id="reset-votes-btn" class="bg-gray-700 hover:bg-red-700 text-white px-8 rounded-xl font-bold transition">
                ุชุตููุฑ ูุงูุฉ ุงูุฃุตูุงุช (ูุญูููู ูุฌูููุฑ)
            </button>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงููุญููุฉ (ูููุณุชุฎุฏููู) -->
    <div id="court-view" class="hidden w-full max-w-7xl p-4 md:p-6 mb-20">
        <!-- ุงูููุฏุฑ -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
            <div>
                <div class="flex items-center gap-3 mb-1">
                    <span id="role-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-gray-700 border border-gray-600">ุฒุงุฆุฑ</span>
                    <span class="flex h-3 w-3 relative">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                    </span>
                    <span class="text-xs text-red-400 font-bold">ุจุซ ูุจุงุดุฑ</span>
                </div>
                <h1 id="display-case-title" class="text-2xl md:text-4xl font-black text-momo-judge leading-tight">ุฌุงุฑู ุชุญููู ุงููุถูุฉ...</h1>
            </div>
            <button onclick="location.reload()" class="text-gray-500 hover:text-white transition">
                <i data-lucide="log-out"></i>
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- ุงูุนููุฏ ุงูุฌุงูุจู: ุงูุฃุดุฎุงุต -->
            <div class="lg:col-span-3 space-y-4 order-2 lg:order-1">
                <!-- ุงููุงุถู -->
                <div class="glass-panel p-4 rounded-xl border-r-4 border-momo-judge relative overflow-hidden group">
                    <div class="absolute -right-4 -top-4 text-momo-judge opacity-10 group-hover:opacity-20 transition">
                        <i data-lucide="gavel" class="w-24 h-24"></i>
                    </div>
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">ุงููุงุถู</h3>
                    <p id="display-judge" class="text-xl font-bold text-momo-judge truncate">...</p>
                </div>

                <!-- ุงููุชูู ูุงููุฌูู ุนููู -->
                <div class="grid grid-cols-2 gap-2">
                    <div class="bg-gray-800 p-3 rounded-lg border border-gray-700">
                        <h3 class="text-xs text-gray-500 mb-1">ุงููุชูู ๐</h3>
                        <p id="display-accused" class="font-bold text-white truncate">...</p>
                        <div class="mt-2 text-xs text-gray-400">
                            <span class="block">ุงูุฏูุงุน:</span>
                            <span id="display-def-lawyer" class="text-momo-def">...</span>
                        </div>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg border border-gray-700">
                        <h3 class="text-xs text-gray-500 mb-1">ุงููุฌูู ุนููู ๐ค</h3>
                        <p id="display-victim" class="font-bold text-white truncate">...</p>
                        <div class="mt-2 text-xs text-gray-400">
                            <span class="block">ุงูุงุฏุนุงุก:</span>
                            <span id="display-pros-lawyer" class="text-momo-pros">...</span>
                        </div>
                    </div>
                </div>
                
                <!-- ุงููุญูููู (ุฌุฏูุฏ) -->
                <div class="bg-gray-800 p-4 rounded-xl border-l-4 border-momo-jury">
                    <h3 class="text-xs font-bold text-gray-400 uppercase mb-2 flex items-center gap-2">
                        <i data-lucide="users" class="w-3 h-3"></i> ูุฌูุฉ ุงููุญูููู
                    </h3>
                    <p id="display-jurors" class="text-sm text-gray-300 leading-relaxed whitespace-pre-line">...</p>
                </div>
            </div>

            <!-- ุงูุนููุฏ ุงูุฑุฆูุณู: ุงูุชูุงุตูู ูุงูุฃุฏูุฉ ูุงูุดููุฏ -->
            <div class="lg:col-span-6 space-y-6 order-1 lg:order-2">
                <!-- ุงููุตุฉ -->
                <div class="glass-panel p-6 rounded-2xl shadow-xl">
                    <h3 class="text-xl font-bold mb-4 text-gray-200 flex items-center gap-2">
                        <i data-lucide="file-text" class="text-momo-judge"></i>
                        ุญูุซูุงุช ุงููุถูุฉ
                    </h3>
                    <div class="bg-gray-900/50 p-4 rounded-xl border border-gray-700/50">
                        <p id="display-case-desc" class="text-gray-300 leading-8 whitespace-pre-line text-lg font-light">...</p>
                    </div>
                </div>

                <!-- ูุณู ุงูุดููุฏ ุงูุฌุฏูุฏ -->
                <div class="glass-panel p-6 rounded-2xl shadow-xl border border-cyan-900/50">
                    <h3 class="text-xl font-bold mb-4 text-cyan-400 flex items-center gap-2">
                        <i data-lucide="eye" class="text-cyan-400"></i>
                        ุฃููุงู ุงูุดููุฏ
                    </h3>
                    <div id="display-witnesses-container" class="space-y-4">
                        <p class="text-gray-400 text-center">ูุง ููุฌุฏ ุดููุฏ ูุณุฌููู ุญุงููุงู.</p>
                    </div>
                </div>

                <!-- ุฃุฏูุฉ ุงูุฅุฏุงูุฉ (ูุธูุฑ ููุงุฏุนุงุกุ ุงููุงุถูุ ุงููุญูููู) -->
                <div id="section-evidence-guilt" class="hidden transform transition-all hover:scale-[1.01]">
                    <div class="bg-gradient-to-l from-red-900/20 to-gray-800 p-6 rounded-xl border-r-4 border-momo-pros">
                        <h3 class="text-lg font-bold mb-3 text-momo-pros flex items-center gap-2">
                            <i data-lucide="flame"></i> ุฃุฏูุฉ ุงูุฅุฏุงูุฉ
                        </h3>
                        <p id="display-ev-guilt" class="text-gray-300 whitespace-pre-line leading-7">...</p>
                    </div>
                </div>

                <!-- ุฃุฏูุฉ ุงูุจุฑุงุกุฉ (ูุธูุฑ ููุฏูุงุนุ ุงููุงุถูุ ุงููุญูููู) -->
                <div id="section-evidence-innocence" class="hidden transform transition-all hover:scale-[1.01]">
                    <div class="bg-gradient-to-l from-blue-900/20 to-gray-800 p-6 rounded-xl border-r-4 border-momo-def">
                        <h3 class="text-lg font-bold mb-3 text-momo-def flex items-center gap-2">
                            <i data-lucide="shield"></i> ุฃุฏูุฉ ุงูุจุฑุงุกุฉ
                        </h3>
                        <p id="display-ev-innocence" class="text-gray-300 whitespace-pre-line leading-7">...</p>
                    </div>
                </div>
            </div>

            <!-- ุงูุนููุฏ ุงูุฌุงูุจู: ุงูุชุตููุช -->
            <div class="lg:col-span-3 order-3">
                <div class="sticky top-6 space-y-6">
                    
                    <!-- ูุชุงุฆุฌ ุงูุฌูููุฑ (ูุธูุฑ ููุท ูููุงุถู) -->
                    <div id="judge-public-results" class="hidden glass-panel p-6 rounded-2xl border-2 border-momo-public shadow-2xl animate-pulse-slow">
                        <h3 class="font-bold text-momo-public mb-4 text-center flex items-center justify-center gap-2 text-xl">
                            <i data-lucide="bar-chart-2"></i> ุฑุฃู ุงูุฌูููุฑ
                        </h3>
                        <div class="flex items-center justify-between text-sm mb-2">
                            <span class="text-green-400">ุจุฑูุก</span>
                            <span class="text-red-400">ูุฏุงู</span>
                        </div>
                        <div class="h-4 bg-gray-900 rounded-full overflow-hidden flex relative border border-gray-600">
                            <div id="pub-bar-innocent" class="bg-green-500 h-full transition-all duration-1000 flex items-center justify-center text-[10px] text-black font-bold" style="width: 50%">0</div>
                            <div id="pub-bar-guilty" class="bg-red-500 h-full transition-all duration-1000 flex items-center justify-center text-[10px] text-white font-bold" style="width: 50%">0</div>
                        </div>
                        <div class="flex justify-between mt-2 text-xs text-gray-400 font-mono">
                            <span id="pub-count-innocent">0 ุตูุช</span>
                            <span id="pub-count-guilty">0 ุตูุช</span>
                        </div>
                    </div>

                    <!-- ููุญุฉ ุชุตููุช ุงูุฌูููุฑ (ูุธูุฑ ููุถููู ููุท) -->
                    <div id="audience-voting-section" class="hidden glass-panel p-6 rounded-2xl border border-momo-public/30 shadow-[0_0_15px_rgba(56,178,172,0.1)]">
                        <h3 class="font-bold text-momo-public mb-4 text-center flex items-center justify-center gap-2">
                            <i data-lucide="thumbs-up"></i> ุชุตููุช ุงูุฌูููุฑ
                        </h3>
                        <p class="text-xs text-gray-400 text-center mb-4">ุดุงุฑู ุจุฑุฃูู ูู ุงููุถูุฉุ ุฑุฃูู ุณูุตู ูููุงุถู ูุจุงุดุฑุฉ!</p>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="voteAudience('innocent')" class="group relative overflow-hidden bg-green-900/40 hover:bg-green-600 border border-green-600 text-green-100 py-4 rounded-lg transition-all duration-300">
                                <span class="relative z-10 font-bold text-lg">ุจุฑูุก</span>
                                <div class="absolute inset-0 bg-green-500 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left opacity-20"></div>
                            </button>
                            <button onclick="voteAudience('guilty')" class="group relative overflow-hidden bg-red-900/40 hover:bg-red-600 border border-red-600 text-red-100 py-4 rounded-lg transition-all duration-300">
                                <span class="relative z-10 font-bold text-lg">ูุฏุงู</span>
                                <div class="absolute inset-0 bg-red-500 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left opacity-20"></div>
                            </button>
                        </div>
                    </div>

                    <!-- ููุญุฉ ุงููุญูููู -->
                    <div id="jury-section" class="hidden glass-panel p-6 rounded-2xl border border-momo-jury/30 shadow-[0_0_15px_rgba(128,90,213,0.1)]">
                        <h3 class="font-bold text-momo-jury mb-4 text-center flex items-center justify-center gap-2">
                            <i data-lucide="gavel"></i> ูุฑุงุฑ ุงููุญูููู
                        </h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="vote('innocent')" class="group relative overflow-hidden bg-green-900/40 hover:bg-green-600 border border-green-600 text-green-100 py-3 rounded-lg transition-all duration-300">
                                <span class="relative z-10 font-bold">ุจุฑูุก</span>
                                <div class="absolute inset-0 bg-green-500 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left opacity-20"></div>
                            </button>
                            <button onclick="vote('guilty')" class="group relative overflow-hidden bg-red-900/40 hover:bg-red-600 border border-red-600 text-red-100 py-3 rounded-lg transition-all duration-300">
                                <span class="relative z-10 font-bold">ูุฏุงู</span>
                                <div class="absolute inset-0 bg-red-500 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left opacity-20"></div>
                            </button>
                        </div>
                    </div>

                    <!-- ูุชุงุฆุฌ ุชุตููุช ุงููุญูููู ุงูุญูุฉ -->
                    <div id="jury-stats-display" class="bg-gray-800 p-6 rounded-2xl shadow-lg text-center">
                        <p class="text-xs text-momo-jury uppercase tracking-widest mb-4 font-bold">ูุชุงุฆุฌ ุงููุญูููู</p>
                        
                        <div class="flex items-end justify-between px-2 mb-2">
                            <div class="text-center">
                                <span id="count-innocent" class="block text-3xl font-black text-green-500">0</span>
                                <span class="text-xs text-green-400">ุจุฑูุก</span>
                            </div>
                            <div class="text-gray-600 pb-2">VS</div>
                            <div class="text-center">
                                <span id="count-guilty" class="block text-3xl font-black text-red-500">0</span>
                                <span class="text-xs text-red-400">ูุฏุงู</span>
                            </div>
                        </div>

                        <!-- ุดุฑูุท ุงููุณุจุฉ -->
                        <div class="h-3 bg-gray-700 rounded-full overflow-hidden flex relative">
                            <div id="bar-innocent" class="bg-green-500 h-full transition-all duration-1000" style="width: 50%"></div>
                            <div id="bar-guilty" class="bg-red-500 h-full transition-all duration-1000" style="width: 50%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        // ุงุณุชูุฑุงุฏ initializeFirestore ูุงุณุชุฎุฏุงู ุฅุนุฏุงุฏุงุช ูุฎุตุตุฉ
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, updateDoc, increment, initializeFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
        const firebaseConfig = {
            apiKey: "AIzaSyBipomSPVclk5J9aFVmSJvGkk2P22YRkrU",
            authDomain: "judge-31fea.firebaseapp.com",
            projectId: "judge-31fea",
            storageBucket: "judge-31fea.firebasestorage.app",
            messagingSenderId: "820112341118",
            appId: "1:820112341118:web:bdc569841ed81467e6802f",
            measurementId: "G-QTW6XF41PF"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        
        // ุชููุฆุฉ Firestore ูุน Long Polling ูุญู ูุดููุฉ ุงูุงุชุตุงู
        const db = initializeFirestore(app, {
            experimentalForceLongPolling: true,
        });

        const auth = getAuth(app);
        
        const CASE_DOC_ID = 'live-case-001';

        // --- ุฅุฏุงุฑุฉ ุงูุงุชุตุงู ูุงููุตุงุฏูุฉ ---
        const connectionStatus = document.getElementById('connection-status');
        const errorToast = document.getElementById('error-toast');
        const errorMsg = document.getElementById('error-msg');

        function showError(msg) {
            errorMsg.innerText = msg;
            errorToast.style.display = 'block';
            setTimeout(() => errorToast.style.display = 'none', 5000);
        }
        
        function ensureAuth() {
            connectionStatus.style.display = 'block';
            signInAnonymously(auth)
                .then(() => {
                    console.log("Firestore Auth: Connected");
                    connectionStatus.style.display = 'none';
                })
                .catch((error) => {
                    console.error("Auth Error:", error);
                    connectionStatus.innerText = "ูุดู ุงูุงุชุตุงู: " + error.code;
                    connectionStatus.classList.add('bg-red-600');
                    showError("ูุดู ูู ุงููุตุงุฏูุฉ ูุน ุงูุณูุฑูุฑ: " + error.message);
                });
        }
        
        ensureAuth();

        // --- ุชููุฆุฉ ุงููุงุฌูุฉ ---
        lucide.createIcons();

        const witnessContainer = document.getElementById('witness-admin-container');
        for (let i = 1; i <= 10; i++) {
            const div = document.createElement('div');
            div.className = "bg-gray-900 p-3 rounded border border-gray-700";
            div.innerHTML = `
                <div class="text-xs text-cyan-500 mb-1 font-bold">ุงูุดุงูุฏ ุฑูู ${i}</div>
                <input id="w-name-${i}" placeholder="ุงุณู ุงูุดุงูุฏ" class="w-full mb-2 p-2 bg-gray-800 rounded border border-gray-600 text-sm focus:border-cyan-500 outline-none">
                <textarea id="w-scenario-${i}" placeholder="ุงูุณููุงุฑูู / ุงูุฃููุงู" class="w-full p-2 bg-gray-800 rounded border border-gray-600 text-sm h-16 resize-none focus:border-cyan-500 outline-none"></textarea>
            `;
            witnessContainer.appendChild(div);
        }

        // --- ุงููุธุงุฆู ---

        window.checkCode = function() {
            const codeInput = document.getElementById('access-code');
            const code = codeInput.value.trim().toUpperCase();
            
            // ุงูุณูุงุญ ุจุงูุฏุฎูู ุญุชู ูู ุงูุญูู ูุงุฑุบ (ููุฌูููุฑ)
            const loginScreen = document.getElementById('login-screen');
            const adminView = document.getElementById('admin-view');
            const courtView = document.getElementById('court-view');
            
            loginScreen.style.opacity = '0';
            setTimeout(() => {
                loginScreen.style.display = 'none';
                
                if (code === 'ADMIN99') {
                    adminView.style.display = 'block';
                    adminView.classList.add('animate-fade-in');
                    loadAdminData();
                } else {
                    courtView.style.display = 'block';
                    courtView.classList.add('animate-fade-in');
                    setupRoleView(code); // ุฅุฐุง ูุงู ุงูููุฏ ูุงุฑุบ ุณูุนุชุจุฑ ุถูู
                }
                lucide.createIcons();
            }, 300);
        };

        // --- ููุทู ุงูุฃุฏูู ---
        
        document.getElementById('save-btn').addEventListener('click', async () => {
            if (!auth.currentUser) {
                showError("ุบูุฑ ูุชุตู ุจุงูุณูุฑูุฑ. ุงูุชุธุฑ ููููุงู...");
                ensureAuth();
                return;
            }

            const btn = document.getElementById('save-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="animate-pulse">โณ ุฌุงุฑู ุงูุญูุธ ูู ุงูุณุญุงุจุฉ...</span>';
            btn.disabled = true;
            
            const timeoutId = setTimeout(() => {
                btn.innerHTML = 'โ๏ธ ุงูุนูููุฉ ุชุฃุฎุฑุช. ุชุญูู ูู ุงููููุณูู';
                btn.disabled = false;
            }, 15000);

            const witnessesData = [];
            for(let i=1; i<=10; i++) {
                const name = document.getElementById(`w-name-${i}`).value;
                const scenario = document.getElementById(`w-scenario-${i}`).value;
                if(name.trim() || scenario.trim()) {
                    witnessesData.push({ name, scenario });
                }
            }

            const caseData = {
                title: document.getElementById('inp-case-title').value,
                description: document.getElementById('inp-case-desc').value,
                judge: document.getElementById('inp-judge').value,
                victim: document.getElementById('inp-victim').value,
                accused: document.getElementById('inp-accused').value,
                defLawyer: document.getElementById('inp-def-lawyer').value,
                prosLawyer: document.getElementById('inp-pros-lawyer').value,
                jurors: document.getElementById('inp-jurors').value,
                witnessesData: witnessesData,
                evGuilt: document.getElementById('inp-ev-guilt').value,
                evInnocence: document.getElementById('inp-ev-innocence').value,
            };

            const caseRef = doc(db, 'court', CASE_DOC_ID);
            
            try {
                await setDoc(caseRef, caseData, { merge: true });
                clearTimeout(timeoutId);
                btn.innerHTML = 'ุชู ุงูุญูุธ ุจูุฌุงุญ! โ';
                btn.classList.remove('bg-green-600');
                btn.classList.add('bg-green-500');
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    btn.classList.add('bg-green-600');
                    btn.classList.remove('bg-green-500');
                }, 2000);
            } catch (err) {
                clearTimeout(timeoutId);
                console.error("Firestore Save Error:", err);
                showError("ูุดู ุงูุญูุธ: " + err.message);
                btn.innerHTML = 'โ ูุดู';
                setTimeout(() => { btn.innerHTML = originalText; btn.disabled = false; }, 2000);
            }
        });

        document.getElementById('reset-votes-btn').addEventListener('click', async () => {
            if(confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุชุตููุฑ ูุงูุฉ ุงูุฃุตูุงุช (ุงููุญูููู ูุงูุฌูููุฑ)ุ')) {
                const caseRef = doc(db, 'court', CASE_DOC_ID);
                try {
                    await setDoc(caseRef, { 
                        votes: { innocent: 0, guilty: 0 },
                        audienceVotes: { innocent: 0, guilty: 0 } // ุชุตููุฑ ุฃุตูุงุช ุงูุฌูููุฑ ุฃูุถุงู
                    }, { merge: true });
                    alert("ุชู ุชุตููุฑ ุฌููุน ุงูุฃุตูุงุช.");
                } catch(err) {
                    showError("ุญุฏุซ ุฎุทุฃ: " + err.message);
                }
            }
        });

        async function loadAdminData() {
             const caseRef = doc(db, 'court', CASE_DOC_ID);
             try {
                 const docSnap = await getDoc(caseRef);
                 if (docSnap.exists()) {
                     const data = docSnap.data();
                     document.getElementById('inp-case-title').value = data.title || '';
                     document.getElementById('inp-case-desc').value = data.description || '';
                     document.getElementById('inp-judge').value = data.judge || '';
                     document.getElementById('inp-victim').value = data.victim || '';
                     document.getElementById('inp-accused').value = data.accused || '';
                     document.getElementById('inp-def-lawyer').value = data.defLawyer || '';
                     document.getElementById('inp-pros-lawyer').value = data.prosLawyer || '';
                     document.getElementById('inp-jurors').value = data.jurors || '';
                     document.getElementById('inp-ev-guilt').value = data.evGuilt || '';
                     document.getElementById('inp-ev-innocence').value = data.evInnocence || '';

                     if(data.witnessesData && Array.isArray(data.witnessesData)) {
                         data.witnessesData.forEach((w, index) => {
                             if(index < 10) {
                                 document.getElementById(`w-name-${index+1}`).value = w.name || '';
                                 document.getElementById(`w-scenario-${index+1}`).value = w.scenario || '';
                             }
                         });
                     }
                 }
             } catch (err) {
                 console.error("Error loading data:", err);
                 showError("ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุณุงุจูุฉ");
             }
        }

        // --- ููุทู ุงููุดุงูุฏ ูุงูุฃุฏูุงุฑ ---

        function setupRoleView(code) {
            const roleBadge = document.getElementById('role-badge');
            const guiltSection = document.getElementById('section-evidence-guilt');
            const innocenceSection = document.getElementById('section-evidence-innocence');
            const jurySection = document.getElementById('jury-section');
            const audienceVotingSection = document.getElementById('audience-voting-section');
            const judgePublicResults = document.getElementById('judge-public-results');
            
            let roleName = "ุถูู (ุฌูููุฑ)";
            let roleClass = "bg-gray-600 text-gray-200";

            if (code === 'JUDGE1') {
                roleName = "ุงููุงุถู โ๏ธ";
                roleClass = "bg-momo-judge text-black";
                guiltSection.style.display = 'block';
                innocenceSection.style.display = 'block';
                judgePublicResults.style.display = 'block'; // ุงููุงุถู ูุฑู ูุชุงุฆุฌ ุงูุฌูููุฑ
            } 
            else if (code === 'DEFENSE1') {
                roleName = "ุงูุฏูุงุน ๐ก๏ธ";
                roleClass = "bg-momo-def text-white";
                innocenceSection.style.display = 'block';
            }
            else if (code === 'PROS1') {
                roleName = "ุงูุงุฏุนุงุก ๐ฅ";
                roleClass = "bg-momo-pros text-white";
                guiltSection.style.display = 'block';
            }
            else if (code === 'JURY1') {
                roleName = "ุงููุญูููู ๐ฅ";
                roleClass = "bg-momo-jury text-white";
                jurySection.style.display = 'block'; // ุงููุญูููู ูุตูุชูู ููุง
                guiltSection.style.display = 'block';
                innocenceSection.style.display = 'block';
            }
            else if (code === 'WITNESS1') {
                roleName = "ุดุงูุฏ ๐๏ธ";
                roleClass = "bg-cyan-600 text-white";
            }
            else {
                // ููุฒูุงุฑ / ุงูุฌูููุฑ (ููุฏ ูุงุฑุบ ุฃู ุบูุฑ ูุนุฑูู)
                audienceVotingSection.style.display = 'block';
            }

            roleBadge.textContent = roleName;
            roleBadge.className = `px-3 py-1 rounded-full text-xs font-bold border border-white/20 shadow-lg ${roleClass}`;

            // ุงูุงุณุชูุงุน ููุชุญุฏูุซุงุช
            const caseRef = doc(db, 'court', CASE_DOC_ID);
            
            onSnapshot(caseRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();

                    updateText('display-case-title', data.title);
                    updateText('display-case-desc', data.description);
                    updateText('display-judge', data.judge);
                    updateText('display-accused', data.accused);
                    updateText('display-victim', data.victim);
                    updateText('display-def-lawyer', data.defLawyer);
                    updateText('display-pros-lawyer', data.prosLawyer);
                    updateText('display-jurors', data.jurors);
                    updateText('display-ev-guilt', data.evGuilt);
                    updateText('display-ev-innocence', data.evInnocence);

                    // ุงูุดููุฏ
                    const witnessesContainer = document.getElementById('display-witnesses-container');
                    
                    if (data.witnessesData && Array.isArray(data.witnessesData) && data.witnessesData.length > 0) {
                        witnessesContainer.innerHTML = '';
                        data.witnessesData.forEach(w => {
                            const wDiv = document.createElement('div');
                            wDiv.className = "bg-gray-800 p-4 rounded-xl border border-gray-700 hover:border-cyan-600 transition";
                            wDiv.innerHTML = `
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="bg-cyan-900/50 p-2 rounded-full">
                                        <i data-lucide="user" class="w-4 h-4 text-cyan-400"></i>
                                    </div>
                                    <h4 class="font-bold text-white text-lg">${w.name || 'ุดุงูุฏ ูุฌููู'}</h4>
                                </div>
                                <div class="bg-gray-900/50 p-3 rounded-lg border border-gray-700/30">
                                    <p class="text-gray-300 text-sm leading-relaxed whitespace-pre-line">${w.scenario || 'ูุง ููุฌุฏ ุฃููุงู ูุณุฌูุฉ.'}</p>
                                </div>
                            `;
                            witnessesContainer.appendChild(wDiv);
                        });
                        lucide.createIcons();
                    } else {
                        witnessesContainer.innerHTML = '<p class="text-gray-500 text-center py-4">ูู ูุชู ุงุณุชุฏุนุงุก ุดููุฏ ููุฐู ุงูุฌูุณุฉ.</p>';
                    }

                    // ุชุญุฏูุซ ุฃุตูุงุช ุงููุญูููู (Jury)
                    const iVotes = data.votes?.innocent || 0;
                    const gVotes = data.votes?.guilty || 0;
                    const total = iVotes + gVotes;

                    document.getElementById('count-innocent').innerText = iVotes;
                    document.getElementById('count-guilty').innerText = gVotes;

                    if (total > 0) {
                        const iPercent = (iVotes / total) * 100;
                        const gPercent = (gVotes / total) * 100;
                        document.getElementById('bar-innocent').style.width = `${iPercent}%`;
                        document.getElementById('bar-guilty').style.width = `${gPercent}%`;
                    } else {
                        document.getElementById('bar-innocent').style.width = `50%`;
                        document.getElementById('bar-guilty').style.width = `50%`;
                    }

                    // ุชุญุฏูุซ ุฃุตูุงุช ุงูุฌูููุฑ (Public) - ุชุธูุฑ ููุท ูููุงุถู
                    const pIVotes = data.audienceVotes?.innocent || 0;
                    const pGVotes = data.audienceVotes?.guilty || 0;
                    const pTotal = pIVotes + pGVotes;

                    document.getElementById('pub-count-innocent').innerText = pIVotes + " ุตูุช";
                    document.getElementById('pub-count-guilty').innerText = pGVotes + " ุตูุช";
                    
                    const pBarInnocent = document.getElementById('pub-bar-innocent');
                    const pBarGuilty = document.getElementById('pub-bar-guilty');

                    if (pTotal > 0) {
                        const piPercent = (pIVotes / pTotal) * 100;
                        const pgPercent = (pGVotes / pTotal) * 100;
                        pBarInnocent.style.width = `${piPercent}%`;
                        pBarInnocent.innerText = Math.round(piPercent) + "%";
                        pBarGuilty.style.width = `${pgPercent}%`;
                        pBarGuilty.innerText = Math.round(pgPercent) + "%";
                    } else {
                        pBarInnocent.style.width = `50%`;
                        pBarInnocent.innerText = "0";
                        pBarGuilty.style.width = `50%`;
                        pBarGuilty.innerText = "0";
                    }
                }
            }, (error) => {
                console.error("Listen Error:", error);
            });
        }

        function updateText(id, text) {
            const el = document.getElementById(id);
            if(el && el.innerText !== text && text !== undefined) {
                el.innerText = text || '...';
                el.classList.add('animate-pulse');
                setTimeout(() => el.classList.remove('animate-pulse'), 500);
            }
        }

        // ุชุตููุช ุงููุญูููู
        window.vote = async function(type) {
            if (!auth.currentUser) return showError("ุฌุงุฑู ุงูุงุชุตุงู..");
            const caseRef = doc(db, 'court', CASE_DOC_ID);
            try {
                await updateDoc(caseRef, { [`votes.${type}`]: increment(1) });
                animateButton(event.currentTarget);
            } catch (err) { showError("ูุดู ุงูุชุตููุช: " + err.message); }
        };

        // ุชุตููุช ุงูุฌูููุฑ (ุฌุฏูุฏ)
        window.voteAudience = async function(type) {
            if (!auth.currentUser) return showError("ุฌุงุฑู ุงูุงุชุตุงู..");
            const caseRef = doc(db, 'court', CASE_DOC_ID);
            try {
                await updateDoc(caseRef, { [`audienceVotes.${type}`]: increment(1) });
                const btn = event.currentTarget;
                animateButton(btn);
                
                // ุฅุถุงูุฉ ุชุบุฐูุฉ ุฑุงุฌุนุฉ ุจุณูุทุฉ
                const originalText = btn.innerHTML;
                btn.innerText = "ุชู ุงูุฅุฑุณุงู!";
                setTimeout(() => btn.innerHTML = originalText, 1000);
                
            } catch (err) { showError("ูุดู ุงูุชุตููุช: " + err.message); }
        };

        function animateButton(btn) {
            const originalColor = btn.style.borderColor;
            btn.style.borderColor = "#FFF";
            setTimeout(() => btn.style.borderColor = originalColor, 200);
        }
    </script>
</body>
</html>